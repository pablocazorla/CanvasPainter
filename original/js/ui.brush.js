var brushCtrl=function(a){return this.init(a)};brushCtrl.prototype={presets:[],currentPreset:null,presetChanged:!1,init:function(a){this.app=a,this.preview=document.getElementById("brush-preview-cnv"),this.previewC=this.preview.getContext("2d"),this.previewTxt=document.getElementById("brush-preview-txt"),this.ctrlPrincipal=document.getElementById("brush-ctrl-principal"),this.ctrlSec=document.getElementById("brush-ctrl-sec"),this.ctrlRandom=document.getElementById("brush-ctrl-random"),this.ctrlPresets=document.getElementById("brush-ctrl-presets");var b=this;return this.sliderSize=new slider({parent:this.ctrlPrincipal,id:"slider-size-brush",title:"Size (px)",titleOver:"The size of the brush",min:1,max:300,initVal:20,callback:function(){app.brush.setting.radius=b.sliderSize.getValue(),b.presetChanged=!0,b.updatePreview()}}),this.sliderOpacity=new slider({parent:this.ctrlPrincipal,id:"slider-opacity-brush",title:"Opacity (%)",titleOver:"The opacity of the brush",initVal:100,callback:function(){app.brush.setting.opacity=b.sliderOpacity.getValue()/100,b.presetChanged=!0,b.updatePreview()}}),this.sliderSpacing=new slider({parent:this.ctrlSec,id:"slider-spacing-brush",title:"Spacing (%)",titleOver:"The spacing of the brush",min:1,initVal:30,callback:function(){app.brush.setting.spacing=b.sliderSpacing.getValue()/100,b.presetChanged=!0,b.updatePreview()}}),this.sliderHardness=new slider({parent:this.ctrlSec,id:"slider-hardness-brush",title:"Hardness (%)",titleOver:"The hardness of the brush",min:1,initVal:100,callback:function(){app.brush.setting.hardness=b.sliderHardness.getValue()/100,b.presetChanged=!0,b.updatePreview()}}),this.sliderBlending=new slider({parent:this.ctrlSec,id:"slider-blending-brush",title:"Blending (%)",titleOver:"The blending of the brush",initVal:0,callback:function(){app.brush.setting.blending=b.sliderBlending.getValue()/100,b.presetChanged=!0,b.updatePreview(),app.brush.setting.blending>0?b.switcherDirtBrush.toogleEnabled(!0):b.switcherDirtBrush.toogleEnabled(!1)}}),this.switcherDirtBrush=new switcher({parent:this.ctrlSec,id:"switcher-dirt-brush",title:"Dirt color:",titleOver:"if the color of the brush is remains",startDisable:!0,callback:function(){app.brush.setting.dirtcolor=b.switcherDirtBrush.status(),b.presetChanged=!0,b.updatePreview()}}),this.sliderRoundness=new slider({parent:this.ctrlSec,id:"slider-roundness-brush",title:"Roundness (%)",titleOver:"The roundness of the brush",min:1,initVal:100,callback:function(){app.brush.setting.roundness=b.sliderRoundness.getValue()/100,b.presetChanged=!0,b.updatePreview()}}),this.sliderRotation=new slider({parent:this.ctrlSec,id:"slider-rotation-brush",title:"Angle (\xba)",titleOver:"The angle (degrees) of the brush",min:0,max:180,initVal:0,callback:function(){app.brush.setting.rotation=b.sliderRotation.getValue(),b.presetChanged=!0,b.updatePreview()}}),this.sliderRandomSize=new slider({parent:this.ctrlRandom,id:"slider-random-size-brush",title:"Size (%)",titleOver:"The random size of the brush",initVal:0,callback:function(){app.brush.setting.randomRadius=b.sliderRandomSize.getValue()/100,b.presetChanged=!0}}),this.sliderRandomOpacity=new slider({parent:this.ctrlRandom,id:"slider-random-opacity-brush",title:"Opacity (%)",titleOver:"The random opacity of the brush",initVal:0,callback:function(){app.brush.setting.randomOpacity=b.sliderRandomOpacity.getValue()/100}}),this.sliderRandomColor=new slider({parent:this.ctrlRandom,id:"slider-random-color-brush",title:"Color (%)",titleOver:"The random color of the brush",initVal:0,callback:function(){app.brush.setting.randomColor=b.sliderRandomColor.getValue()/100}}),this.sliderRandomHardness=new slider({parent:this.ctrlRandom,id:"slider-random-hardness-brush",title:"Hardness (%)",titleOver:"The random hardness of the brush",initVal:0,callback:function(){app.brush.setting.randomHardness=b.sliderRandomHardness.getValue()/100,b.presetChanged=!0}}),this.sliderRandomRoundness=new slider({parent:this.ctrlRandom,id:"slider-random-roundness-brush",title:"Roundness (%)",titleOver:"The random roundness of the brush",initVal:0,callback:function(){app.brush.setting.randomRoundness=b.sliderRandomRoundness.getValue()/100,b.presetChanged=!0}}),this.sliderRandomRotation=new slider({parent:this.ctrlRandom,id:"slider-random-rotation-brush",title:"Angle (%)",titleOver:"The random angle of the brush",initVal:0,callback:function(){app.brush.setting.randomRotation=b.sliderRandomRotation.getValue()/100,b.presetChanged=!0}}),this.sliderRandomScattering=new slider({parent:this.ctrlRandom,id:"slider-random-scattering-brush",title:"Scattering (%)",titleOver:"The random scattering of the brush",initVal:0,callback:function(){app.brush.setting.randomScattering=b.sliderRandomScattering.getValue()/100,b.presetChanged=!0}}),this},setDefaultPresets:function(){this.setBrushCtrlOpen();for(var a=[{name:"Hard",setting:{radius:20,type:"circle",spacing:.15,opacity:1,hardness:1,rotation:0,roundness:1,blending:0,dirtcolor:!1,randomOpacity:0,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:0,randomScattering:0,randomColor:0}},{name:"Soft",setting:{radius:20,type:"circle",spacing:.19,opacity:.75,hardness:.15,rotation:0,roundness:1,blending:0,dirtcolor:!1,randomOpacity:0,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:0,randomScattering:0,randomColor:0}},{name:"Pencil",setting:{radius:3,type:"circle",spacing:.3,opacity:1,hardness:.65,rotation:0,roundness:.55,blending:0,dirtcolor:!1,randomOpacity:.49,randomHardness:.5,randomRotation:1,randomRoundness:0,randomRadius:.12,randomScattering:0,randomColor:0}},{name:"Oil",setting:{radius:20,type:"circle",spacing:.15,opacity:1,hardness:.81,rotation:155,roundness:.66,blending:.48,dirtcolor:!0,randomOpacity:0,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:0,randomScattering:0,randomColor:0}},{name:"Watercolor",setting:{radius:30,type:"circle",spacing:.08,opacity:.2,hardness:.71,rotation:139,roundness:.69,blending:.61,dirtcolor:!0,randomOpacity:.11,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:.02,randomScattering:0,randomColor:0}},{name:"Airbrush",setting:{radius:100,type:"circle",spacing:.21,opacity:.42,hardness:.2,rotation:0,roundness:1,blending:0,dirtcolor:!1,randomOpacity:0,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:0,randomScattering:0,randomColor:0}},{name:"Blender",setting:{radius:8,type:"circle",spacing:.1,opacity:.14,hardness:.6,rotation:0,roundness:1,blending:1,dirtcolor:!1,randomOpacity:0,randomHardness:0,randomRotation:0,randomRoundness:0,randomRadius:0,randomScattering:.04,randomColor:0}},{name:"Drops",setting:{radius:3,type:"circle",spacing:1,opacity:1,hardness:1,rotation:0,roundness:1,blending:0,dirtcolor:!1,randomOpacity:.79,randomHardness:.54,randomRotation:0,randomRoundness:.22,randomRadius:1,randomScattering:.26,randomColor:0}},{name:"Clouds",setting:{radius:63,type:"circle",spacing:.3,opacity:1,hardness:.1,rotation:0,roundness:.57,blending:0,dirtcolor:!1,randomOpacity:.3,randomHardness:.16,randomRotation:1,randomRoundness:0,randomRadius:.55,randomScattering:.01,randomColor:.17}}],b=0;b<a.length;b++)this.addPreset(a[b]);return delete a,this.setPreset(0),this},addPreset:function(a){this.presets.push(a);var b=this.presets.length-1;preset=document.createElement("div"),cnv=document.createElement("canvas"),txt=document.createElement("div"),siz=document.createElement("span"),preset.setAttribute("rel",b),preset.className="brush-preset",txt.className="brush-preset-txt",txt.innerHTML=a.name,cnv.width="58",cnv.height="58",siz.innerHTML=a.setting.radius,preset.title=a.name+" ("+a.setting.radius+"px)",this.ctrlPresets.appendChild(preset),preset.appendChild(cnv),preset.appendChild(txt),preset.appendChild(siz),this.setPreset(b);var c=cnv.getContext("2d");c.globalAlpha=app.brush.setting.opacity;var d=app.brush.setting.radius;d>29&&(d=29),app.brush.draw(29,29,c,d);var e=this;return preset.addEventListener("click",function(){e.setPreset(parseInt(this.getAttribute("rel")))},!1),this},setPreset:function(a){return this.currentPreset=cloneObj(this.presets[a]),app.brush.changeSetting(this.currentPreset.setting),this.presetChanged=!1,this.update(),this},updatePreview:function(){var a=this.currentPreset.setting.radius+"px";this.presetChanged&&(a="(modified)"),this.previewTxt.innerHTML=this.currentPreset.name+"<br>"+a,this.previewC.globalAlpha=app.brush.setting.opacity;var b=app.brush.setting.radius;return b>40&&(b=40),this.previewC.clearRect(0,0,90,90),app.brush.draw(45,45,this.previewC,b),this},update:function(){this.sliderSize.update(app.brush.setting.radius),this.sliderOpacity.update(100*app.brush.setting.opacity),this.sliderSpacing.update(100*app.brush.setting.spacing),this.sliderHardness.update(100*app.brush.setting.hardness),this.sliderBlending.update(100*app.brush.setting.blending),this.switcherDirtBrush.status(app.brush.setting.dirtcolor),this.sliderRoundness.update(100*app.brush.setting.roundness),this.sliderRotation.update(app.brush.setting.rotation),this.sliderRandomSize.update(100*app.brush.setting.randomRadius),this.sliderRandomOpacity.update(100*app.brush.setting.randomOpacity),this.sliderRandomColor.update(100*app.brush.setting.randomColor),this.sliderRandomHardness.update(100*app.brush.setting.randomHardness),this.sliderRandomRoundness.update(100*app.brush.setting.randomRoundness),this.sliderRandomRotation.update(100*app.brush.setting.randomRotation),this.sliderRandomScattering.update(100*app.brush.setting.randomScattering),this.updatePreview()},setBrushCtrlOpen:function(){var a=this,b=document.getElementById("palet-brush").getElementsByClassName("palet-content")[0],c=document.getElementById("title-brush-ctrl-sec"),d=document.getElementById("title-brush-ctrl-random"),e=document.getElementById("title-brush-ctrl-presets"),f=function(c,d){var e=parseInt(window.getComputedStyle(b).getPropertyValue("height"));c.flag?(c.className="brush-ctrl-item-title",d.style.display="none",b.style.height=e-c.h+"px",c.flag=!1):(c.className="brush-ctrl-item-title open",d.style.display="block",b.style.height=e+c.h+"px",c.flag=!0);try{a.update(),app.ui.paletBrush.savePalStyle()}catch(f){}};c.flag=!1,d.flag=!1,e.flag=!1,c.h=230,d.h=280,e.h=0,c.addEventListener("click",function(){f(c,a.ctrlSec)},!1),d.addEventListener("click",function(){f(d,a.ctrlRandom)},!1),e.addEventListener("click",function(){f(e,a.ctrlPresets)},!1),f(e,a.ctrlPresets)}};